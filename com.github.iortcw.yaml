app-id: com.github.iortcw
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "20.08"
command: iortcw_sp.sh

finish-args:
- --device=dri
- --socket=wayland
- --socket=fallback-x11
- --socket=x11
- --share=ipc
- --share=network
- --socket=pulseaudio
- --persist=.wolf

cleanup:
- /app/include
- /app/lib/*.a
- /app/lib/*.la
- /app/lib/pkgconfig

modules:

- name: iortcw-source
  buildsystem: simple
  config-opts:
  - -DCMAKE_BUILD_TYPE=Release
  build-commands:
   # For historic reasons, single- and multiplayer are different binaries
   - cd /run/build/iortcw-source/SP/ && COPYDIR=/app/bin/ make copyfiles
   - cd /run/build/iortcw-source/MP/ && COPYDIR=/app/bin/ make copyfiles
  sources:
  - type: archive
    url: https://github.com/iortcw/iortcw/archive/1.51c.tar.gz
    sha256: 0f6c136db1e5c6115e044190655163b9784bbef9b0667ec2a8900abd79565e83

- name: launcher
  buildsystem: simple
  sources:
  # singleplayer
  - type: script
    dest-filename: iortcw_sp.sh
    commands:
    - ls ~/.wolf/main/pak0.pk3 || zenity --error --text "Game data (pak0.pk3 etc.) must be added to:\n~/.var/app/com.github.iortcw/.wolf/main/" --ok-label "Close" --width=400
    - /app/bin/iowolfsp.x86_64
    # multiplayer
  - type: script
    dest-filename: iortcw_mp.sh
    commands:
    - ls ~/.wolf/main/pak0.pk3 || zenity --error --text "Game data (pak0.pk3 etc.) must be added to:\n~/.var/app/com.github.iortcw/.wolf/main/" --ok-label "Close" --width=400
    - /app/bin/iowolfmp.x86_64
  - type: file
    path: com.github.iortcw.desktop
  - type: file
    path: com.github.iortcw.appdata.xml
  - type: file
    path: com.github.iortcw.svg
  build-commands:
  - install -Dm 744 iortcw_sp.sh -t /app/bin
  - install -Dm 744 iortcw_mp.sh -t /app/bin
  - install -Dm 644 com.github.iortcw.desktop -t /app/share/applications
  - install -Dm 644 com.github.iortcw.appdata.xml -t /app/share/metainfo
  - install -Dm 644 com.github.iortcw.svg /app/share/icons/hicolor/scalable/apps/com.github.iortcw.svg


